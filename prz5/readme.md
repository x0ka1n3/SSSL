# Практическая работа №5. Threat Hunting

Для работы были использованы уже ранее созданные в [ПРЗ №3](../prz3/) стенды Wazuh.

![](./assets/1.png)

## Установка и настройка IDS Suricata

Установка Suricata из репозитория:

![](./assets/3.png)

Загрузка правил обнаружения:

![](./assets/4.png)

Настройка импорта логов Suricata в Wazuh и перезапуск агента:

![](./assets/5.png)

![](./assets/6.png)

## Установка и настройка Yara

### Настройка агента

Загрузка и распаковка дистрибутива:

![](./assets/7.png)

Установка Yara:

![](./assets/8.png)

![](./assets/9.png)

![](./assets/10.png)

![](./assets/11.png)

![](./assets/12.png)

![](./assets/14.png)

Загрузка YARA-правил:

![](./assets/15.png)

Создание скрипта `yara.sh` для Wazuh и настройка владельца и прав на скрипт:

![](./assets/16.png)

![](./assets/17.png)

Настройка правил мониторинга в файле `/var/ossec/etc/ossec.conf`, перезапуск агента:

![](./assets/18.png)

![](./assets/19.png)

### Настройка сервера

Настройка правил Wazuh для отслеживания изменений и срабатывания правил YARA:

![](./assets/20.png)

Настройка декодера результатов сканирования Yara:

![](./assets/21.png)

Настройка команд Wazuh, который будут запускать сканирование при обнаружении изменений в отслеживаемой директории:

![](./assets/22.png)

Загрузка вредоносных файлов с помощью скрипта из официальной документации:

![](./assets/26.png)

Срабатывание Yara:

![](./assets/27.png)

## Эмуляция атаки

Для проверки Suricata была использована утилита для сканирования хостов `nuclei`:

![](./assets/28.png)

События Suricata:

![](./assets/29.png)